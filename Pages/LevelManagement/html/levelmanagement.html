<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>关卡管理 - NISA Welcome System</title>
    <link rel="stylesheet" href="/Pages/Common/css/base.css">
    <link rel="stylesheet" href="/Pages/LevelManagement/css/levelmanagement.css?v=20250103">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- 统一导航栏将通过JavaScript自动插入 -->
    
    <div class="page-container">
        <div class="main-container">
            <div class="header-section">
                <h1><i class="fas fa-map-marked-alt"></i> 关卡管理</h1>
            </div>

        <!-- 统计面板 -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon total">
                    <i class="fas fa-flag-checkered"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" id="totalLevels">0</div>
                    <div class="stat-label">关卡数</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon active">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" id="activeLevels">0</div>
                    <div class="stat-label">已激活关卡</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon inactive">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" id="inactiveLevels">0</div>
                    <div class="stat-label">未激活关卡</div>
                </div>
            </div>
        </div>

        <!-- 操作面板 -->
        <div class="action-panel">
            <div class="search-section">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="搜索关卡名称或描述..." />
                </div>
                <button class="btn btn-primary" onclick="searchLevels()">
                    <i class="fas fa-search"></i> 搜索
                </button>
                <button class="btn btn-secondary" onclick="clearSearch()">
                    <i class="fas fa-times"></i> 清空
                </button>
            </div>
            <div class="filter-section">
                <label for="statusFilter">状态筛选：</label>
                <select id="statusFilter" onchange="filterLevels()">
                    <option value="all">所有关卡</option>
                    <option value="active">已激活</option>
                    <option value="inactive">未激活</option>
                </select>
            </div>
            <div class="action-buttons">
                <button class="btn btn-success" onclick="showAddLevelModal()">
                    <i class="fas fa-plus"></i> 添加关卡
                </button>
            </div>
        </div>

        <!-- 关卡列表 -->
        <div class="levels-container">
            <div class="table-header">
                <h3><i class="fas fa-list"></i> 关卡列表</h3>
            </div>
            <div class="table-container">
                <table class="levels-table">
                    <thead>
                        <tr>
                            <th>关卡名称</th>
                            <th>关卡信息</th>
                            <th>积分</th>
                            <th>激活状态</th>
                        </tr>
                    </thead>
                    <tbody id="levelsTableBody">
                        <!-- 关卡数据将通过JavaScript动态填充 -->
                    </tbody>
                </table>
            </div>
            <div class="pagination" id="pagination">
                <!-- 分页控件将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <!-- 添加/编辑关卡模态框 -->
    <div id="levelModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">添加关卡</h3>
                <span class="close" onclick="closeLevelModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="levelForm">
                    <div class="form-group">
                        <label for="levelName">关卡名称 *</label>
                        <input type="text" id="levelName" name="name" required placeholder="输入关卡名称">
                    </div>
                    <div class="form-group">
                        <label for="levelInfo">关卡信息</label>
                        <textarea id="levelInfo" name="info" rows="3" placeholder="输入关卡信息和说明"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="pointsReward">积分 *</label>
                        <input type="number" id="pointsReward" name="points" required min="0" placeholder="关卡积分">
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeLevelModal()">
                    <i class="fas fa-times"></i> 取消
                </button>
                <button type="button" class="btn btn-primary" onclick="saveLevel()">
                    <i class="fas fa-save"></i> 保存
                </button>
            </div>
        </div>
    </div>

    <!-- 关卡详情模态框 -->
    <div id="levelDetailModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>关卡详情</h3>
                <span class="close" onclick="closeLevelDetailModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="levelDetailContent">
                    <!-- 详情内容将通过JavaScript动态填充 -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeLevelDetailModal()">
                    <i class="fas fa-times"></i> 关闭
                </button>
            </div>
        </div>
    </div>

    <!-- 参与者列表模态框 -->
    <div id="participantsModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>参与者列表</h3>
                <span class="close" onclick="closeParticipantsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="participantsContent">
                    <!-- 参与者列表将通过JavaScript动态填充 -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeParticipantsModal()">
                    <i class="fas fa-times"></i> 关闭
                </button>
                <button type="button" class="btn btn-info" onclick="exportParticipants()">
                    <i class="fas fa-download"></i> 导出参与者
                </button>
            </div>
        </div>
    </div>

    <!-- 删除确认模态框 -->
    <div id="deleteModal" class="modal">
        <div class="modal-content small">
            <div class="modal-header">
                <h3>确认删除</h3>
                <span class="close" onclick="closeDeleteModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="deleteMessage">确定要删除此关卡吗？此操作不可恢复！</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">
                    <i class="fas fa-times"></i> 取消
                </button>
                <button type="button" class="btn btn-danger" onclick="confirmDelete()">
                    <i class="fas fa-trash"></i> 删除
                </button>
            </div>
        </div>
    </div>

    <script src="/Pages/Common/js/utils.js"></script>
    <script src="/Pages/LevelManagement/js/levelmanagement.js"></script>
    <!-- 引入统一导航栏组件 -->
    <script src="/Pages/Common/js/navigation.js"></script>
</body>
</html>